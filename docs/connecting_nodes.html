<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Connecting Nodes | Remus</title>
    <meta name="description" content="Making RDMA Programming Easy, Without Sacrificing Performance">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/remus-tutorial-2025/assets/style.CyihjThI.css" as="style">
    <link rel="preload stylesheet" href="/remus-tutorial-2025/vp-icons.css" as="style">
    
    <script type="module" src="/remus-tutorial-2025/assets/app.CnEC4xpY.js"></script>
    <link rel="preload" href="/remus-tutorial-2025/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/framework.Cf11ooiF.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/theme.D5AieDu1.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/katex.ChWnQ-fc.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/dagre-OKDRZEBW.xRwEMOne.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/c4Diagram-VJAJSXHY.DSsXS5Bq.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/flowDiagram-4HSFHLVR.HPQIDGY_.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/erDiagram-Q7BY3M3F.D1s4B2M6.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/gitGraphDiagram-7IBYFJ6S.DNyqdpYo.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/ganttDiagram-APWFNJXF.BPVUWAVr.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/infoDiagram-PH2N3AL5.D1pxonMO.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/pieDiagram-IB7DONF6.DIi9mMVT.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/quadrantDiagram-7GDLP6J5.B7xWgq1f.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/xychartDiagram-VJFVF3MP.CWp1Oz0P.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/requirementDiagram-KVF5MWMF.DOFYxw43.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/sequenceDiagram-X6HHIX6F.BqFAGn84.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/classDiagram-GIVACNV2.Br2nGXkF.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/classDiagram-v2-COTLJTTW.Br2nGXkF.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/stateDiagram-DGXRK772.CHZdq1Vl.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/stateDiagram-v2-YXO3MK2T.BOXTa2lc.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/journeyDiagram-U35MCT3I.BrFEZgvc.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/timeline-definition-BDJGKUSR.CsOB76MG.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/mindmap-definition-ALO5MXBD.D0gNiuLG.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/kanban-definition-NDS4AKOZ.FRrTPVYA.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/sankeyDiagram-QLVOVGJD.Yck_0Fhw.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/diagram-VNBRO52H.CZ2e3nfK.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/diagram-SSKATNLV.CP1S88uR.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/blockDiagram-JOT3LUYC.D-Cx6XaD.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/architectureDiagram-IEHRJDOE.DCjf9KGQ.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/remus-tutorial-2025/assets/connecting_nodes.md.Ctb9PpbT.lean.js">
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle has-sidebar" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/remus-tutorial-2025/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="public/lulogo.png" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>Remus</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!----></div><!----><!----><!----><!----><!----><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-42c4c606><div class="curtain" data-v-42c4c606></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-42c4c606><span class="visually-hidden" id="sidebar-aria-label" data-v-42c4c606> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-51288d80><section class="VPSidebarItem level-0 has-active" data-v-51288d80 data-v-0009425e><!----><div class="items" data-v-0009425e><!--[--><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/remus-tutorial-2025/getting_started.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Getting Started</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/remus-tutorial-2025/building_and_running.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Building And Running</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/remus-tutorial-2025/connecting_nodes.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Connecting Nodes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/remus-tutorial-2025/allocating_and_accessing_memory.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Allocating and Accessing Memory</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/remus-tutorial-2025/lazy_list.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Building A Concurrent Data Structure</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-0009425e data-v-0009425e><div class="item" data-v-0009425e><div class="indicator" data-v-0009425e></div><a class="VPLink link link" href="/remus-tutorial-2025/advanced_features.html" data-v-0009425e><!--[--><p class="text" data-v-0009425e>Advanced Remus Features</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _remus-tutorial-2025_connecting_nodes" data-v-e6f2a212><div><h1 id="connecting-nodes" tabindex="-1">Connecting Nodes <a class="header-anchor" href="#connecting-nodes" aria-label="Permalink to &quot;Connecting Nodes&quot;">​</a></h1><p>In the previous step of the tutorial, you started a program on CloudLab and provided it with some configuration arguments, but the program did not use those arguments. In this step, you&#39;ll use them to actually set up some distributed shared memory and coordinate among machines.</p><h2 id="a-cleaner-starting-point" tabindex="-1">A Cleaner Starting Point <a class="header-anchor" href="#a-cleaner-starting-point" aria-label="Permalink to &quot;A Cleaner Starting Point&quot;">​</a></h2><p>There are several fields of <code>args</code> that get accessed a lot. To start this step of the tutorial, re-create your code from the previous step, and then extract a few key arguments:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;memory&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;remus/remus.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &lt;vector&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> argc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> **</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">argv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INIT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Configure and parse the arguments</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make_shared</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ArgMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::ARGS);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(argc, argv);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::HELP)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">usage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">report_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Extract the args for determining names and roles</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::NODE_ID);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::FIRST_MN_ID);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::LAST_MN_ID);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::FIRST_CN_ID);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cn </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::LAST_CN_ID);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="machine-roles" tabindex="-1">Machine Roles <a class="header-anchor" href="#machine-roles" aria-label="Permalink to &quot;Machine Roles&quot;">​</a></h2><p>In Remus programs, there are two different behaviors that a process / machine can perform. If the machine is a Memory Node, then it allocates memory and makes that memory available to other machines. If the machine is a Compute Node, then it is able to use the memory provided by the Memory Nodes.<br> A machine can also serve in both roles.</p><p>The distinction between these types of nodes is important. The role of Memory Node is a <em>passive</em> role: Memory Nodes do not have the ability to initiate any communication with other nodes, and cannot send messages to other nodes. They provide a region of memory that Compute Nodes can use to interact with each other. A Memory Node also can <em>receive</em> a small amount of information through the <em>control block</em> that is embedded at the root of each memory segment that it serves.</p><h2 id="topologies" tabindex="-1">Topologies <a class="header-anchor" href="#topologies" aria-label="Permalink to &quot;Topologies&quot;">​</a></h2><p>The <code>MN</code> and <code>CN</code> arguments are used by Remus to create a network topology and connect machines. For simplicity, Remus refers to machines using unique numbers, starting with zero. A machine can serve as a Compute Node, a Memory Node, or both.</p><p>Remus has been tested in two configurations:</p><ul><li>Some machines are Memory Nodes and others are Compute Nodes</li><li>All machines are <em>both</em> Memory Nodes and Compute Nodes</li></ul><p>Remus uses the <code>ARGS</code> to do most of the set-up work automatically. Here is an example where there are eight available nodes, and the program was run with <code>--first_mn_id 0 --last_mn_id 3 --first_cn_id 4 --last_cn_id 7</code>:</p><p><img src="/remus-tutorial-2025/assets/m4c4.B4Zw4i28.png" alt="Four Compute Nodes connected to four Memory Nodes" title="Four
Compute Nodes, Four Memory Nodes"></p><p>The number of Compute Nodes does not need to match the number of Memory Nodes. Here is an example with six available nodes, where four are Memory Nodes and two are Compute Nodes (<code>--first_mn_id 0 --last_mn_id 3 --first_cn_id 4 --last_cn_id 5</code>):</p><p><img src="/remus-tutorial-2025/assets/m4c2.CrnIn9zl.png" alt="Two Compute Nodes connected to four Memory Nodes" title="Two Compute
Nodes, Four Memory Nodes"></p><p>You might instead need lots of parallelism. Here is an example with six available nodes, where two are Memory Nodes and four are Compute Nodes (<code>--first_mn_id 0 --last_mn_id 1 --first_cn_id 2 --last_cn_id 5</code>):</p><p><img src="/remus-tutorial-2025/assets/m2c4.Cx7KZBev.png" alt="Four Compute Nodes connected to two Memory Nodes" title="Four
Compute Nodes, Two Memory Nodes"></p><p>Here is an example with four available nodes, all of which are serving as both Compute Nodes and Memory Nodes (<code>--first_mn_id 0 --last_mn_id 3 --first_cn_id 0 --last_cn_id 3</code>): <img src="/remus-tutorial-2025/assets/mc4.BV2MR7Ag.png" alt="Four compute+Memory Nodes connected to each
other" title="Four Nodes, All Serving In Both Roles"></p><p>You should feel free to try out different configurations, but as you do, please note the following requirements:</p><ul><li>There must always be at least one Compute Node and at least one Memory Node</li><li>The numerical ranges for Compute Nodes and for Memory Nodes must be contiguous</li><li>Memory Nodes should not have larger numbers than Compute Nodes</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>These requirements may be relaxed in a later version of Remus</p></div><h2 id="converting-names" tabindex="-1">Converting Names <a class="header-anchor" href="#converting-names" aria-label="Permalink to &quot;Converting Names&quot;">​</a></h2><p>Remus uses numerical indices to refer to machines. This works seamlessly with CloudLab, but may require extra support for other clusters. To prevent programs from being too tightly coupled to CloudLab, the translation from indices to DNS names is not built into Remus. For CloudLab, where the translation is easy, you&#39;ll want to include the <code>benchmark/cloudlab.h</code> file, which provides the <code>id_to_dns_name</code> function:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;cloudlab.h&quot;</span></span></code></pre></div><p>Using this function and the <code>m0</code> and <code>mn</code> arguments to the program, you can compute the DNS names of the machines that will serve as Memory Nodes:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // prepare network information about this machine and about memnodes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::vector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::MachineInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> memnodes;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m0; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mn; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    memnodes.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">emplace_back</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id_to_dns_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>Every node (whether a Memory Node or a Compute Node) will also need to know its specific numerical identifier:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Compute the name of this machine</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MachineInfo</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">id_to_dns_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id));</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you run on a system other than CloudLab, you&#39;ll probably want to use a second <code>ARGS</code> object to provide the information needed to implement your own <code>id_to_dns_name()</code> function.</p></div><h2 id="setting-up-memory-nodes" tabindex="-1">Setting Up Memory Nodes <a class="header-anchor" href="#setting-up-memory-nodes" aria-label="Permalink to &quot;Setting Up Memory Nodes&quot;">​</a></h2><p>A process might serve as a Memory Node, a Compute Node, or both. When a process has both roles, it&#39;s important that Memory Node configuration comes first:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Configure as a MemoryNode?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::unique_ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::MemoryNode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> memory_node;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> m0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mn) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Make the pools, await connections</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    memory_node.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">MemoryNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, args));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>Within the <code>MemoryNode</code> constructor, the <code>SEGS_PER_MN</code> and <code>SEG_SIZE</code> flags will be used to allocate distributed shared memory. The product of these two arguments determines the total amount of memory that a <code>MemoryNode</code> will share. There are two reasons why Remus allocates several segments, instead of just one:</p><ul><li>On some systems, there is a maximum size for each allocation (for example, CloudLab&#39;s r320 machines may behave erratically when segments are larger than <mjx-container class="MathJax" jax="SVG" style="direction:ltr;position:relative;"><svg style="overflow:visible;min-height:1px;min-width:1px;vertical-align:0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewBox="0 -833.9 1290.1 833.9" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)" style="stroke-width:3;"></path></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mn>29</mn></mrow></msup></math></mjx-assistive-mml></mjx-container>).</li><li>In some applications, dedicating one segment to each program thread can give better performance.</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>It is best to enable &quot;huge page&quot; support on your system, and to ensure that each segment is a multiple of the huge page size.</p></div><p>Similarly, sometimes it is advantageous to have more than one connection between a <code>ComputeNode</code> and a <code>MemoryNode</code>. The <code>--qp-lanes</code> flag determines how many connections will be made from each <code>ComputeNode</code> to each <code>MemoryNode</code>.</p><p>Once all memory is allocated and registered with the RDMA network card, the <code>MemoryNode</code> will start listening on the <code>MN_PORT</code> port until it has received <code>QP_LANES</code> connections from each <code>ComputeNode</code> other than itself. This listening happens on a separate thread, so that a machine can be both a <code>MemoryNode</code> and a <code>ComputeNode</code>. When a machine is both a <code>ComputeNode</code> and a <code>MemoryNode</code>, it leverages the <em>loopback</em> device to create connections to itself.</p><h2 id="setting-up-compute-nodes" tabindex="-1">Setting Up Compute Nodes <a class="header-anchor" href="#setting-up-compute-nodes" aria-label="Permalink to &quot;Setting Up Compute Nodes&quot;">​</a></h2><p>After possibly configuring the process as a Memory Node, it&#39;s time to set it up as a Compute Node:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Configure as a ComputeNode?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::shared_ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::ComputeNode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compute_node;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cn) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    compute_node.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComputeNode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, args));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // NB:  If this ComputeNode is also a MemoryNode, then we need to pass the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //      rkeys to the local MemoryNode.  There&#39;s no harm in doing them first.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (memory_node.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nullptr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      compute_node-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connect_local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(memnodes, memory_node-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get_local_rkeys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    compute_node-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connect_remote</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(memnodes);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>The <code>ComputeNode</code> constructor uses the <code>CN_THREAD_BUFSZ</code> argument to create a region of memory that it carves up and will allocate among threads, so they have a place to stage data when interacting with remote machines.</p><p>In addition to creating the <code>ComputeNode</code>, this code block reaches out and connects to each <code>MemoryNode</code>. It turns out that connecting to <code>localhost</code> is complicated, so the code has a special process for handling it. In particular, the process needs to know the &quot;rkeys&quot; (remote keys) for addressing the Memory Node&#39;s segments.</p><h2 id="finishing-network-set-up" tabindex="-1">Finishing Network Set-Up <a class="header-anchor" href="#finishing-network-set-up" aria-label="Permalink to &quot;Finishing Network Set-Up&quot;">​</a></h2><p>In general, it&#39;s not good to keep threads running, even if they&#39;re idle or blocked. When all Compute Nodes have finished connecting to the Memory Node, you should immediately instruct the Memory Node to stop its listening thread:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Reclaim threads when all connections have been made</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (memory_node) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    memory_node-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">init_done</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>At this point, the network is fully configured. From here, your Compute Nodes could start making Compute Threads and interacting through the Memory Nodes&#39; shared memory.</p><h2 id="graceful-shut-down" tabindex="-1">Graceful Shut Down <a class="header-anchor" href="#graceful-shut-down" aria-label="Permalink to &quot;Graceful Shut Down&quot;">​</a></h2><p>If you were to run the program right now, the Memory Nodes would never terminate. You can test this by typing:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./cl.sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local/my_config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build-run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> local/my_experiment</span></span></code></pre></div><p>To recover from this situation, you&#39;ll need to press <code>ctrl-c</code> in each screen. Then use <code>./cl.sh local/my_config connect</code> to connect to your allocated machines, and type <code>killall hello</code> in each screen.</p><p>The problem is that the Memory Node destructor waits until it has received a shutdown notification from every Compute Thread. These notifications happen automatically in the <code>ComputeThread</code> destructor. So, to put it simply, you&#39;ll need to create a bunch of <code>ComputeThread</code> objects and then let them destruct. You don&#39;t even need to make real <em>threads</em> here or assign those threads <code>ComputeThread</code> objects: it&#39;s enough to just make the objects and let them destruct:</p><div class="language-c++ vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">c++</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Create Compute Threads, so they can signal to the Memory Nodes that</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // they&#39;ve completed</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cn) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::vector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::shared_ptr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::ComputeThread</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> compute_threads;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uint64_t</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> args-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">uget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::CN_THREADS); </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      compute_threads.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push_back</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">          std</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make_shared</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ComputeThread</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(id, compute_node, args));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div><p>Now is a good time to test your program with different configurations. In addition to <code>my_experiment</code>, which has two Memory Nodes and one Compute Node, try running with three nodes that are both Memory Nodes and Compute Nodes. Rename <code>local/my_experiment</code> to <code>local/m2_c1_mc0</code>. Then create <code>local/m0_c0_mc3</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">exefile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build/benchmark/hello</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">experiment_args</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;--seg-size 29 --segs-per-mn 2 --first-cn-id 0 --last-cn-id 2 --first-mn-id 0 --last-mn-id 2 --qp-lanes 2 --qp-sched-pol RR --mn-port 33330 --cn-threads 2 --cn-ops-per-thread 4 --cn-thread-bufsz 20 --alloc-pol GLOBAL-RR&quot;</span></span></code></pre></div><p>When you run with either of these configurations, you should see messages like &quot;Registered region&quot;, &quot;Connecting to remote machine&quot;, and &quot;ComputeThread shutdown&quot; on the Compute nodes, and &quot;MemoryNode shutdown&quot; on the Memory Nodes.</p><p>Feel free to experiment with different numbers of QP lanes, segment sizes, and segments per node.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>CloudLab limits the total amount of RNIC-registered memory to a small number of gigabytes, so choose <code>seg-size</code> and <code>segs-per-mn</code> carefully.</p></div><h2 id="the-anatomy-of-a-segment" tabindex="-1">The Anatomy Of A Segment <a class="header-anchor" href="#the-anatomy-of-a-segment" aria-label="Permalink to &quot;The Anatomy Of A Segment&quot;">​</a></h2><p>To understand how graceful shut-down works, note that Remus reserves the first 64 bytes of each segment for control data. The general layout appears below:</p><p><img src="/remus-tutorial-2025/assets/seg_header.ifSkm5wM.png" alt="The fields of a segment header" title="The fields of a segment header"></p><p>The <code>size</code> and <code>allocated</code> fields are used by every segment, on every Memory Node, to enable Remus to allocate memory from each segment, just like <code>malloc</code> and <code>free</code>. For now, only the <code>barrier</code> in segment 0 of Memory Node 0 is used. It is used as a simple, sense-reversing barrier. It is helpful for global synchronization, e.g., to ensure that all threads reach one milestone before any progresses to the next. The <code>control block</code> is used by Remus to shut down Memory Nodes at the end of the program. Lastly, the <code>root</code> is a generic pointer to distributed memory (and as with <code>barrier</code>, Remus currently only uses the <code>root</code> in segment 0 of Memory Node 0).</p><p>To understand how these fields are used, keep in mind that a distributed program typically needs to tame some of its asynchrony. You cannot predict when each process will start, or when it will reach a specific point in its execution. Some of the challenges a program faces are:</p><ul><li>When can threads start accessing distributed memory?</li><li>How can Memory Nodes know when it&#39;s time to shut down?</li><li>How can threads find the data they&#39;re going to access?</li></ul><p>When a Compute Node starts, it tries to connect to every Memory Node before it tries to access any memory. This addresses the first challenge, because Memory Nodes initialize themselves before they listen for connections, and Compute Nodes do not start using the memory until they&#39;ve created connections. Thus all Memory Nodes will be initialized.</p><p>To address the second problem, Remus uses the control block. Compute Threads increment the control block of segment 0 on each Memory Node when they destruct, and Memory Nodes do not shut down until they see that all Compute Threads have shut down.</p><p>This leaves the third problem. To solve it, Remus uses the barrier and root pointer. After Compute Nodes create all of their Compute Threads, those threads should wait at a barrier. This ensures that all threads are initialized before the program starts doing anything that might require threads to interact. Before reaching the barrier, <em>exactly one thread</em> could allocate and initialize memory from a segment, and then write that memory&#39;s address to the root pointer of segment 0, memory node 0. In this way, after the barrier all threads will be able to reach the same data through the root pointer.</p><p>In more advanced programs, the following sequence is common:</p><ol><li>One thread sets the root to point to some empty data structures</li><li>All threads synchronize at a barrier</li><li>Many threads use the root to create the initial state of the data structures</li><li>All threads synchronize at a barrier</li><li>All threads start using the data structures to do the work of the program</li><li>All threads synchronize at a barrier</li><li>Destructors run and the program shuts down gracefully</li></ol></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link prev" href="/remus-tutorial-2025/building_and_running.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Previous page</span><span class="title" data-v-1bcd8184>Building And Running</span><!--]--></a></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/remus-tutorial-2025/allocating_and_accessing_memory.html" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Allocating and Accessing Memory</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"advanced_features.md\":\"D6fMW6_T\",\"allocating_and_accessing_memory.md\":\"CcSmdxsX\",\"building_and_running.md\":\"Cylj2PLF\",\"connecting_nodes.md\":\"Ctb9PpbT\",\"getting_started.md\":\"cilZK8zi\",\"index.md\":\"Cpj5ioBx\",\"lazy_list.md\":\"DBYHu12V\",\"readme.md\":\"CmSQMfe1\",\"todo.md\":\"Dnf88kxj\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Remus\",\"description\":\"Making RDMA Programming Easy, Without Sacrificing Performance\",\"base\":\"/remus-tutorial-2025/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":false,\"themeConfig\":{\"logo\":\"public/lulogo.png\",\"sidebar\":[{\"items\":[{\"text\":\"Getting Started\",\"link\":\"/getting_started\"},{\"text\":\"Building And Running\",\"link\":\"/building_and_running\"},{\"text\":\"Connecting Nodes\",\"link\":\"/connecting_nodes\"},{\"text\":\"Allocating and Accessing Memory\",\"link\":\"/allocating_and_accessing_memory\"},{\"text\":\"Building A Concurrent Data Structure\",\"link\":\"/lazy_list\"},{\"text\":\"Advanced Remus Features\",\"link\":\"/advanced_features\"}]}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>